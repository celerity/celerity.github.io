"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[575],{832:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>c,toc:()=>d});var i=n(4848),s=n(8453);const r={id:"reductions",title:"Reductions",sidebar_label:"Reductions"},o=void 0,c={id:"reductions",title:"Reductions",description:"Celerity implements cluster-wide reductions in the spirit of",source:"@site/celerity-runtime/docs/reductions.md",sourceDirName:".",slug:"/reductions",permalink:"/docs/reductions",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedBy:"Fabian Knorr",lastUpdatedAt:1722595283e3,frontMatter:{id:"reductions",title:"Reductions",sidebar_label:"Reductions"},sidebar:"docs",previous:{title:"Host Tasks",permalink:"/docs/host-tasks"},next:{title:"Common Pitfalls",permalink:"/docs/pitfalls"}},l={},d=[{value:"Limitations",id:"limitations",level:2},{value:"Only Scalar Reductions",id:"only-scalar-reductions",level:3}];function a(e){const t={a:"a",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(t.p,{children:["Celerity implements cluster-wide reductions in the spirit of\n",(0,i.jsx)(t.a,{href:"https://www.khronos.org/registry/SYCL/specs/sycl-2020/html/sycl-2020.html#sec:reduction",children:"SYCL 2020 reduction variables"}),"."]}),"\n",(0,i.jsxs)(t.p,{children:["The following distributed program computes the sum from 0 to 999 in ",(0,i.jsx)(t.code,{children:"sum_buf"})," using a reduction:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-c++",children:"celerity::distr_queue q;\ncelerity::buffer<size_t, 1> sum_buf{{1}};\nq.submit([&](celerity::handler& cgh) {\n    auto rd = celerity::reduction(sum_buf, cgh, sycl::plus<size_t>{},\n                                  celerity::property::reduction::initialize_to_identity{});\n    cgh.parallel_for(celerity::range<1>{1000}, rd,\n                     [=](celerity::item<1> item, auto& sum) { sum += item.get_id(0); });\n});\n"})}),"\n",(0,i.jsxs)(t.p,{children:["A reduction output buffer can have any dimensionality, but must be unit-sized. Like buffer requirements, the result of\nsuch a reduction is made available on nodes as needed, so the Celerity API does not distinguish between ",(0,i.jsx)(t.code,{children:"Reduce"})," and\n",(0,i.jsx)(t.code,{children:"Allreduce"})," operations like MPI does."]}),"\n",(0,i.jsxs)(t.p,{children:["In Celerity, every reduction operation must have a known identity. For\n",(0,i.jsx)(t.a,{href:"https://www.khronos.org/registry/SYCL/specs/sycl-2020/html/sycl-2020.html#sec:function-objects",children:"SYCL function objects"}),"\nthese are known implicitly, for user-provided functors like lambdas, an explicit identity must be provided:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-c++",children:"auto parity = [](unsigned a, unsigned b) { return (a ^ b) & 1u; };\nauto rd = celerity::reduction(buf, cgh, parity, 0u /* explicit identity */,\n                              celerity::property::reduction::initialize_to_identity{});\n"})}),"\n",(0,i.jsx)(t.h2,{id:"limitations",children:"Limitations"}),"\n",(0,i.jsx)(t.h3,{id:"only-scalar-reductions",children:"Only Scalar Reductions"}),"\n",(0,i.jsx)(t.p,{children:"Currently, the SYCL standard only mandates scalar reductions, i.e. reductions that produce a single scalar value.\nWhile that is useful for synchronization work like terminating a loop on a stopping criterion, it is not enough for\nother common operations like histogram construction. Since Celerity delegates to SYCL for intra-node reductions,\nhigher-dimensional reduction outputs will only become available once SYCL supports them."})]})}function u(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>c});var i=n(6540);const s={},r=i.createContext(s);function o(e){const t=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(r.Provider,{value:t},e.children)}}}]);